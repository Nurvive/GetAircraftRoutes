<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Routes Checker</title>
    <link rel="stylesheet" href="static/styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
</head>
<body>
<h1>Aircraft Routes Visualiser v.0.3</h1>
<h2>Step 1. Choose an airline from list:</h2>

    <table width="100%">
    <tbody>
    <tr>
    <td><label for="airline" name="airline">Airline:</label></td>
    <td>
        <select id="airline-selector" class="airline-selector" style="width: 100%"></select>
        <script type="text/javascript">
            $('.airline-selector').select2({
                ajax: {
                url: '/airlines',
                dataType: 'json'
                }
            });
        </script>
    </td>
    </tr>
    <tr>
    <td style="width: 100%;" colspan="2">
        <button type="submit" onclick="selectAirline()">Select Airline</button>
        <script>
            function selectAirline() {
                var selectList = document.getElementById('airline-selector');
                var value = selectList.options[selectList.selectedIndex].value;
                console.log(value);
                var txt = selectList.options[selectList.selectedIndex].text;
                console.log(txt);
                }
        </script>
    </td>
    </tr>
   <tr>
        <td style="width: 100%;" colspan="2">
            <h2>Step 2. Choose an aircraft from list:</h2>
            {% for plane in fleet %}
            <button class="planeButton" id="{{plane}}">{{plane}}</button>
            {% endfor %}
            <script>
                  const buttons = document.querySelectorAll(".planeButton");
                  buttons.forEach(function (item, index) {
                      item.addEventListener('click', function(){
                          let chosen_aircraft = this.innerText;
                          document.getElementById('aircraft').value=chosen_aircraft
                    });
                });
            </script>
        </td>
    </tr>
    <td><label for="aircraft">Aircraft Type: </label></td>
    <td><input type="text" id="aircraft" name="aircraft_type" placeholder="Select Aircraft from list above"></td>
    </tr>
    <tr>
    <td style="width: 100%;" colspan="2">
        <button type="submit">Get Routes</button>
    </td>
    </tr>
    </tbody>
    </table>

<h2>Step 3. Enjoy the result:</h2>
<h3>Planes: </h3>
<div class="result" >{{AircraftList}}</div>
<h3>Routes operated by {{chosen_airline}} on {{chosen_aircraft}} last week:</h3>
<div class="result" >{{RoutesList}}</div>
<h3>Map Link for routes operated last week on {{chosen_aircraft}} by {{chosen_airline}}:</h3>
<div class="result"><a href="{{GCMapLink}}" target="_blank" rel="noopener noreferrer">{{LinkText}}</a></div>
    <footer class="site-footer">
        <span id="timestamp">Airlines List updated on </span>
        <script>
        fetch('/airlines/timestamp/')
                .then((response) => {
                return response.json();
                })
                .then((data) => {
                console.log(data);
                document.getElementById("timestamp").innerHTML = '  Airlines List updated on ' + data;
                });
        </script>
    </footer>
</body>
</html>